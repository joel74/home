---
- name: sites-available config
  notify: reload nginx
  tags: www
  sudo: yes
  template: >
    dest=/usr/local/etc/nginx/sites-available/{{ item.name }}
    src={{ item.src }}
  with_items:
  - name: "{{ name|mandatory }}"
    src: "{{ src|mandatory }}"

- name: sites-enabled link
  notify: reload nginx
  tags: www
  sudo: yes
  file: >
    dest=/usr/local/etc/nginx/sites-enabled/{{ item.name }}
    src=/usr/local/etc/nginx/sites-available/{{ item.name }}
    state=link
  with_items:
  - name: "{{ name }}"
    state: "{{ state | default('enabled') }}"
  when: item.state == 'enabled'
