---
# address and network variables are defined in network.yml
# certificate variables are defined in easyrsa.yml

openvpn_udp:
  name:   openvpn
  dev:    tun0
  proto:  udp
  chroot: /usr/local/etc/openvpn/openvpn_root
  status: /var/log/openvpn.status
  ipv4:
    network: "{{ demonka_openpvn_udp_inet_net }}"
    mask:    255.255.255.0

openvpn_tcp:
  name:        openvpn_tcp
  dev:         tun1
  proto:       tcp
  tcp_nodelay: true
  chroot:      /usr/local/etc/openvpn/openvpn_tcp_root
  status:      /var/log/openvpn_tcp.status
  ipv4:
    network: "{{ demonka_openvpn_tcp_inet_net }}"
    mask:    255.255.255.0

openvpn_instances:
- "{{ openvpn_udp }}"
- "{{ openvpn_tcp }}"

# pf redirects external packets to the internal
# interface
openvpn_bind_ip:     "{{ demonka_int_inet_ip0 }}"
openvpn_cred:
  ca:   "{{ easyrsa_keydir }}/ca.crt"
  cert: "{{ easyrsa_keydir }}/vpn.juliekoubova.net.crt"
  dh:   "{{ easyrsa_keydir }}/dh1024.pem"
  key:  "{{ easyrsa_keydir }}/vpn.juliekoubova.net.key"
openvpn_max_clients: 16
openvpn_push:
- "route {{ demonka_int_inet_ip0 }} 255.255.255.255 vpn_gateway"
- "dhcp-option DNS {{ demonka_int_inet_ip0 }}"

demonka_openvpn_remote: vpn.juliekoubova.net

openvpn_viscosity:
  clients:
  - { user: julie, client: julie-mbpr }
  - { user: julie, client: julie-mba }
  servers:
  - name:     "juliekoubova.net (UDP)"
    remote:   "{{ demonka_openvpn_remote }}"
    instance: "{{ openvpn_udp }}"

  - name:     "juliekoubova.net (TCP)"
    remote:   "{{ demonka_openvpn_remote }}"
    instance: "{{ openvpn_tcp }}"

  - name:     "juliekoubova.net (TCP, all traffic)"
    remote:   "{{ demonka_openvpn_remote }}"
    instance: "{{ openvpn_tcp }}"
